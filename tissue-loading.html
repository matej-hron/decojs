<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tissue Loading & Saturation - Deco Theory</title>
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2980b9">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Deco Theory">
    <link rel="apple-touch-icon" href="icons/icon.svg">
    <link rel="icon" type="image/svg+xml" href="icons/icon.svg">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom"></script>
    
    <!-- KaTeX for math formulas -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
    <!-- App styles -->
    <link rel="stylesheet" href="css/styles.css?v=6">
</head>
<body>
    <!-- Navigation -->
    <nav class="main-nav">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">ğŸ«§ Deco Theory</a>
            <button class="nav-hamburger" aria-label="Toggle menu" aria-expanded="false">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul class="nav-links">
                <!-- Generated by js/nav.js -->
            </ul>
            <span class="nav-wip-badge">ğŸ§ª Experimental</span>
        </div>
    </nav>

    <!-- Dive Profile Header Bar (Sticky) -->
    <div class="profile-header-bar sticky">
        <div class="profile-header-content">
            <div class="profile-header-info">
                <span class="profile-header-label">Profile:</span>
                <select id="profile-switcher" class="profile-switcher">
                    <!-- Options populated by JavaScript -->
                </select>
                <span id="profile-header-summary" class="profile-header-summary"></span>
            </div>
            <div class="profile-header-actions">
                <a href="dive-setup.html" class="btn btn-small">âœï¸ Customize</a>
            </div>
        </div>
    </div>

    <!-- Disclaimer Banner -->
    <div class="disclaimer-banner">
        âš ï¸ <strong>Educational Use Only</strong> â€” This tool is NOT intended for real dive planning. 
        Never use this for actual dives. Always use certified dive computers, tables, and proper training.
    </div>

    <header>
        <h1>ğŸ¤¿ Tissue Loading & Saturation</h1>
        <p class="subtitle">Visualize how nitrogen saturates and desaturates in your body during a dive</p>
    </header>

    <main>
        <!-- Table of Contents -->
        <nav class="toc">
            <h2>ğŸ“‘ Contents</h2>
            <ul>
                <li><a href="#deco-theory">ğŸ“š Decompression Theory</a></li>
                <li><a href="#henrys-law">ğŸ§ª Henry's Law</a></li>
                <li><a href="#gas-exchange">ğŸ’¨ Gas Exchange Pathway</a></li>
                <li><a href="#saturation-dynamics">ğŸ“ˆ Saturation Dynamics</a></li>
                <li><a href="#half-time-concept">â±ï¸ Half-Time Concept</a></li>
                <li><a href="#half-time-charts">ğŸ“Š Half-Time Charts</a></li>
                <li><a href="#tissue-heterogeneity">ğŸ§  Tissue Types</a></li>
                <li><a href="#buhlmann-compartments">ğŸ—ï¸ BÃ¼hlmann Compartments</a></li>
                <li><a href="#zhl16-variants">ğŸ”§ ZH-L16 Variants</a></li>
                <li><a href="#tissue-chart-section">ğŸ“ˆ Interactive Chart</a></li>
            </ul>
        </nav>

        <!-- Educational Section -->
        <section id="deco-theory" class="education-section">
            <h2>ğŸ“š Understanding Decompression Theory</h2>
            
            <div class="concept-card">
                <h3>Why Does This Matter?</h3>
                <p>
                    When you dive, the increased pressure causes nitrogen from the air you breathe to dissolve 
                    into your body tissues. The deeper you go and the longer you stay, the more nitrogen 
                    accumulates. If you ascend too quickly, this nitrogen can form bubbles in your tissues â€” 
                    causing <strong>decompression sickness (DCS)</strong>, also known as "the bends."
                </p>
            </div>

            <!-- Section 1: Henry's Law -->
            <div class="concept-card" id="henrys-law">
                <h3>ğŸ§ª Henry's Law: Gas Dissolution</h3>
                <p>
                    <strong>Henry's Law</strong> states that the amount of gas dissolved in a liquid is proportional 
                    to the pressure of that gas above the liquid. Think of a soda bottle: when sealed under pressure, 
                    COâ‚‚ stays dissolved. Open the cap (reduce pressure), and bubbles form as gas comes out of solution.
                </p>
                <p>
                    The same principle applies to your body during a dive. As you descend and pressure increases, 
                    more gas dissolves into your blood and tissues. While this applies to <em>all</em> gases you breathe, 
                    <strong>oxygen (Oâ‚‚)</strong> is not a concern for bubble formation because:
                </p>
                <ul>
                    <li>Your body continuously <strong>consumes oxygen</strong> through metabolism</li>
                    <li>Most oxygen in blood is <strong>bound to hemoglobin</strong> in red blood cells, not freely dissolved</li>
                </ul>
                <p>
                    The gas we must carefully manage is <strong>nitrogen (Nâ‚‚)</strong> â€” it's inert (your body doesn't use it) 
                    and makes up 78% of air. For technical divers using trimix, <strong>helium (He)</strong> follows the same 
                    principles but with different solubility characteristics.
                </p>
                
                <table class="data-table small-table">
                    <thead>
                        <tr>
                            <th>Gas</th>
                            <th>Solubility in Blood<br><small>(ml/L per bar, 37Â°C)</small></th>
                            <th>Solubility in Fat<br><small>(ml/L per bar, 37Â°C)</small></th>
                            <th>Fat:Blood Ratio</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Nitrogen (Nâ‚‚)</strong></td>
                            <td>12.3</td>
                            <td>66.1</td>
                            <td>5.4Ã—</td>
                        </tr>
                        <tr>
                            <td>Helium (He)</td>
                            <td>8.6</td>
                            <td>15.7</td>
                            <td>1.8Ã—</td>
                        </tr>
                        <tr>
                            <td>Oxygen (Oâ‚‚)</td>
                            <td>23.9</td>
                            <td>110.5</td>
                            <td>4.6Ã—</td>
                        </tr>
                    </tbody>
                </table>
                <p class="footnote">
                    Notice that fatty tissues can hold <strong>5Ã— more nitrogen</strong> than blood â€” this is why 
                    "slow" tissues take longer to saturate and desaturate!
                </p>
            </div>

            <!-- Section 2: Gas Exchange Pathway -->
            <div class="concept-card" id="gas-exchange">
                <h3>ğŸ« Gas Exchange Pathway</h3>
                <p>
                    Gas flows along the <strong>partial pressure gradient</strong> â€” from higher pressure to lower pressure. 
                    During a dive, the pathway is:
                </p>
                
                <!-- Gas Pathway SVG Visualization -->
                <div class="gas-pathway-container">
                    <div class="gas-pathway-controls">
                        <button id="pathway-descent-btn" class="btn btn-small btn-active">â¬‡ï¸ Descent (On-gassing)</button>
                        <button id="pathway-ascent-btn" class="btn btn-small">â¬†ï¸ Ascent (Off-gassing)</button>
                    </div>
                    
                    <svg class="gas-pathway-svg" viewBox="0 0 700 220" aria-label="Gas exchange pathway diagram">
                        <defs>
                            <!-- Gradient for descent (high pressure on left) -->
                            <linearGradient id="pressureGradientDescent" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#2980b9;stop-opacity:0.9" />
                                <stop offset="100%" style="stop-color:#2980b9;stop-opacity:0.2" />
                            </linearGradient>
                            <!-- Gradient for ascent (high pressure on right / tissues) - same blue, reversed -->
                            <linearGradient id="pressureGradientAscent" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#2980b9;stop-opacity:0.2" />
                                <stop offset="100%" style="stop-color:#2980b9;stop-opacity:0.9" />
                            </linearGradient>
                        </defs>
                        
                        <!-- Regulator -->
                        <g class="pathway-stage" transform="translate(30, 60)">
                            <rect x="0" y="0" width="100" height="80" rx="8" class="stage-box stage-regulator" />
                            <text x="50" y="35" text-anchor="middle" class="stage-icon" style="font-size: 14px; font-weight: 600;">TANK</text>
                            <text x="50" y="55" text-anchor="middle" class="stage-label">Breathing Gas</text>
                            <text x="50" y="72" text-anchor="middle" class="stage-value" id="reg-pressure">ppNâ‚‚ = 3.16</text>
                        </g>
                        
                        <!-- Arrow 1: Regulator â†’ Alveoli -->
                        <g class="pathway-arrow" transform="translate(140, 90)">
                            <path d="M 0 10 L 40 10" stroke="#2980b9" stroke-width="3" fill="none" class="arrow-line" />
                            <polygon points="40,10 30,5 30,15" class="arrow-head arrow-head-right" />
                            <polygon points="0,10 10,5 10,15" class="arrow-head arrow-head-left" style="display:none" />
                            <path id="arrow-path-1" d="M 0 10 L 40 10" fill="none" stroke="none" />
                            <path id="arrow-path-1-rev" d="M 40 10 L 0 10" fill="none" stroke="none" />
                            <!-- Particles for descent -->
                            <circle class="gas-particle particle-descent" r="4" fill="#3498db">
                                <animateMotion dur="1.5s" repeatCount="indefinite" keyPoints="0;1" keyTimes="0;1" calcMode="linear">
                                    <mpath href="#arrow-path-1" />
                                </animateMotion>
                            </circle>
                            <circle class="gas-particle particle-descent" r="4" fill="#3498db">
                                <animateMotion dur="1.5s" repeatCount="indefinite" keyPoints="0;1" keyTimes="0;1" calcMode="linear" begin="0.5s">
                                    <mpath href="#arrow-path-1" />
                                </animateMotion>
                            </circle>
                            <!-- Particles for ascent (hidden initially) -->
                            <circle class="gas-particle particle-ascent" r="4" fill="#3498db" style="display:none">
                                <animateMotion dur="1.5s" repeatCount="indefinite" keyPoints="0;1" keyTimes="0;1" calcMode="linear">
                                    <mpath href="#arrow-path-1-rev" />
                                </animateMotion>
                            </circle>
                            <circle class="gas-particle particle-ascent" r="4" fill="#3498db" style="display:none">
                                <animateMotion dur="1.5s" repeatCount="indefinite" keyPoints="0;1" keyTimes="0;1" calcMode="linear" begin="0.5s">
                                    <mpath href="#arrow-path-1-rev" />
                                </animateMotion>
                            </circle>
                        </g>
                        
                        <!-- Lungs/Alveoli -->
                        <g class="pathway-stage" transform="translate(190, 60)">
                            <rect x="0" y="0" width="100" height="80" rx="8" class="stage-box stage-lungs" />
                            <text x="50" y="30" text-anchor="middle" class="stage-icon">ğŸ«</text>
                            <text x="50" y="55" text-anchor="middle" class="stage-label">Alveoli</text>
                            <text x="50" y="72" text-anchor="middle" class="stage-value" id="alv-pressure">ppNâ‚‚ = 3.10</text>
                        </g>
                        
                        <!-- Arrow 2: Alveoli â†’ Blood -->
                        <g class="pathway-arrow" transform="translate(300, 90)">
                            <path d="M 0 10 L 40 10" stroke="#2980b9" stroke-width="3" fill="none" class="arrow-line" />
                            <polygon points="40,10 30,5 30,15" class="arrow-head arrow-head-right" />
                            <polygon points="0,10 10,5 10,15" class="arrow-head arrow-head-left" style="display:none" />
                            <path id="arrow-path-2" d="M 0 10 L 40 10" fill="none" stroke="none" />
                            <path id="arrow-path-2-rev" d="M 40 10 L 0 10" fill="none" stroke="none" />
                            <circle class="gas-particle particle-descent" r="4" fill="#e74c3c">
                                <animateMotion dur="1.5s" repeatCount="indefinite" keyPoints="0;1" keyTimes="0;1" calcMode="linear" begin="0.2s">
                                    <mpath href="#arrow-path-2" />
                                </animateMotion>
                            </circle>
                            <circle class="gas-particle particle-descent" r="4" fill="#e74c3c">
                                <animateMotion dur="1.5s" repeatCount="indefinite" keyPoints="0;1" keyTimes="0;1" calcMode="linear" begin="0.7s">
                                    <mpath href="#arrow-path-2" />
                                </animateMotion>
                            </circle>
                            <circle class="gas-particle particle-ascent" r="4" fill="#3498db" style="display:none">
                                <animateMotion dur="1.5s" repeatCount="indefinite" keyPoints="0;1" keyTimes="0;1" calcMode="linear" begin="0.2s">
                                    <mpath href="#arrow-path-2-rev" />
                                </animateMotion>
                            </circle>
                            <circle class="gas-particle particle-ascent" r="4" fill="#3498db" style="display:none">
                                <animateMotion dur="1.5s" repeatCount="indefinite" keyPoints="0;1" keyTimes="0;1" calcMode="linear" begin="0.7s">
                                    <mpath href="#arrow-path-2-rev" />
                                </animateMotion>
                            </circle>
                        </g>
                        
                        <!-- Blood -->
                        <g class="pathway-stage" transform="translate(350, 60)">
                            <rect x="0" y="0" width="100" height="80" rx="8" class="stage-box stage-blood" />
                            <text x="50" y="30" text-anchor="middle" class="stage-icon">ğŸ’‰</text>
                            <text x="50" y="55" text-anchor="middle" class="stage-label">Blood</text>
                            <text x="50" y="72" text-anchor="middle" class="stage-value" id="blood-pressure">ppNâ‚‚ = 2.5</text>
                        </g>
                        
                        <!-- Arrow 3: Blood â†’ Tissues -->
                        <g class="pathway-arrow" transform="translate(460, 90)">
                            <path d="M 0 10 L 40 10" stroke="#2980b9" stroke-width="3" fill="none" class="arrow-line" />
                            <polygon points="40,10 30,5 30,15" class="arrow-head arrow-head-right" />
                            <polygon points="0,10 10,5 10,15" class="arrow-head arrow-head-left" style="display:none" />
                            <path id="arrow-path-3" d="M 0 10 L 40 10" fill="none" stroke="none" />
                            <path id="arrow-path-3-rev" d="M 40 10 L 0 10" fill="none" stroke="none" />
                            <circle class="gas-particle particle-descent" r="4" fill="#27ae60">
                                <animateMotion dur="1.5s" repeatCount="indefinite" keyPoints="0;1" keyTimes="0;1" calcMode="linear" begin="0.4s">
                                    <mpath href="#arrow-path-3" />
                                </animateMotion>
                            </circle>
                            <circle class="gas-particle particle-descent" r="4" fill="#27ae60">
                                <animateMotion dur="1.5s" repeatCount="indefinite" keyPoints="0;1" keyTimes="0;1" calcMode="linear" begin="1.1s">
                                    <mpath href="#arrow-path-3" />
                                </animateMotion>
                            </circle>
                            <circle class="gas-particle particle-ascent" r="4" fill="#3498db" style="display:none">
                                <animateMotion dur="1.5s" repeatCount="indefinite" keyPoints="0;1" keyTimes="0;1" calcMode="linear" begin="0.4s">
                                    <mpath href="#arrow-path-3-rev" />
                                </animateMotion>
                            </circle>
                            <circle class="gas-particle particle-ascent" r="4" fill="#3498db" style="display:none">
                                <animateMotion dur="1.5s" repeatCount="indefinite" keyPoints="0;1" keyTimes="0;1" calcMode="linear" begin="1.1s">
                                    <mpath href="#arrow-path-3-rev" />
                                </animateMotion>
                            </circle>
                        </g>
                        
                        <!-- Tissues -->
                        <g class="pathway-stage" transform="translate(510, 40)">
                            <rect x="0" y="0" width="160" height="120" rx="8" class="stage-box stage-tissues" />
                            <text x="80" y="25" text-anchor="middle" class="stage-label" style="font-weight: 600;">Tissues</text>
                            <g transform="translate(15, 35)">
                                <text x="0" y="12" class="tissue-label">ğŸ§  Fast</text>
                                <rect x="60" y="0" width="80" height="16" rx="3" fill="#ecf0f1" />
                                <rect x="60" y="0" width="20" height="16" rx="3" class="tissue-fill tissue-fast" />
                            </g>
                            <g transform="translate(15, 58)">
                                <text x="0" y="12" class="tissue-label">ğŸ’ª Med</text>
                                <rect x="60" y="0" width="80" height="16" rx="3" fill="#ecf0f1" />
                                <rect x="60" y="0" width="10" height="16" rx="3" class="tissue-fill tissue-medium" />
                            </g>
                            <g transform="translate(15, 81)">
                                <text x="0" y="12" class="tissue-label">ğŸ¦´ Slow</text>
                                <rect x="60" y="0" width="80" height="16" rx="3" fill="#ecf0f1" />
                                <rect x="60" y="0" width="5" height="16" rx="3" class="tissue-fill tissue-slow" />
                            </g>
                        </g>
                        
                        <!-- Gradient legend -->
                        <g transform="translate(30, 175)">
                            <text x="0" y="12" class="legend-text">Pressure:</text>
                            <text x="60" y="12" class="legend-text legend-high" style="font-weight: 600;">HIGH</text>
                            <rect x="95" y="2" width="80" height="14" rx="3" class="gradient-bar" />
                            <text x="180" y="12" class="legend-text legend-low" style="font-weight: 600;">LOW</text>
                        </g>
                        <g transform="translate(30, 195)">
                            <text x="0" y="12" class="legend-text legend-direction" id="flow-direction">â†’ Gas flows from HIGH to LOW pressure</text>
                        </g>
                    </svg>
                </div>
                
                <details class="learn-more">
                    <summary>ğŸ”¬ Alveolar Pressure Formula</summary>
                    <div class="math-content">
                        <p>The partial pressure of nitrogen in the alveoli accounts for water vapor pressure:</p>
                        <div class="formula" id="formula-alveolar">
                            P_{alv,N_2} = (P_{amb} - P_{H_2O}) \times f_{N_2}
                        </div>
                        <p>Where:</p>
                        <ul>
                            <li><span class="formula-inline">P_{amb}</span> = ambient pressure at depth (bar)</li>
                            <li><span class="formula-inline">P_{H_2O}</span> = water vapor pressure â‰ˆ 0.0627 bar at 37Â°C</li>
                            <li><span class="formula-inline">f_{N_2}</span> = fraction of nitrogen in breathing gas (0.79 for air)</li>
                        </ul>
                    </div>
                </details>
            </div>

            <!-- Section 3: Saturation Dynamics -->
            <div class="concept-card" id="saturation-dynamics">
                <h3>ğŸ“Š Saturation Dynamics During a Dive</h3>
                <p>Understanding how tissue loading changes throughout a dive is key to safe decompression:</p>
                
                <div class="dive-phases">
                    <div class="dive-phase">
                        <h4>â¬‡ï¸ a) Descent â€” On-gassing</h4>
                        <p>
                            As you descend, ambient pressure increases. The partial pressure of nitrogen in your lungs 
                            becomes <strong>higher than in your tissues</strong>, so gas flows <em>into</em> tissues.
                            All compartments begin absorbing nitrogen, but <strong>fast tissues fill first</strong>.
                        </p>
                        <p class="phase-formula">ppNâ‚‚<sub>tissue</sub> &lt; ppNâ‚‚<sub>alveolar</sub> â†’ <strong>On-gassing</strong></p>
                    </div>
                    
                    <div class="dive-phase">
                        <h4>â¡ï¸ b) At Depth â€” Differential Saturation</h4>
                        <p>
                            While at your maximum depth, <strong>fast tissues approach equilibrium</strong> within minutes.
                            Medium tissues continue loading. Slow tissues (like fat) are still far from saturation â€” 
                            they would need hours at depth to fully equilibrate.
                        </p>
                    </div>
                    
                    <div class="dive-phase">
                        <h4>â¬†ï¸ c) Ascent â€” Off-gassing & Supersaturation</h4>
                        <p>
                            As you ascend, the partial pressure of nitrogen in your lungs drops. When tissue nitrogen 
                            pressure exceeds alveolar pressure, the gradient reverses and gas flows <em>out</em> â€” 
                            this is <strong>off-gassing</strong>.
                        </p>
                        <p class="phase-formula">ppNâ‚‚<sub>tissue</sub> &gt; ppNâ‚‚<sub>alveolar</sub> â†’ <strong>Off-gassing</strong></p>
                        <p>
                            But there's another threshold: when tissue nitrogen pressure exceeds <strong>ambient pressure</strong>, 
                            the tissue is <em>supersaturated</em>. This is when we need to be careful â€” the dissolved gas 
                            wants to come out of solution and could form bubbles.
                        </p>
                        <p class="phase-formula">ppNâ‚‚<sub>tissue</sub> &gt; P<sub>ambient</sub> â†’ <strong>Supersaturation</strong> âš ï¸</p>
                    </div>
                </div>
                
                <div class="concept-card warning-card" style="margin-top: 1rem;">
                    <h4>âš ï¸ Critical Supersaturation</h4>
                    <p>
                        Some supersaturation is <strong>tolerable</strong> â€” our bodies can handle a certain amount 
                        of excess dissolved gas without forming bubbles. However, if tissues become <em>too</em> 
                        supersaturated, dissolved nitrogen can form bubbles instead of diffusing out safely.
                    </p>
                    <p>
                        The maximum tolerable supersaturation is called <strong>critical supersaturation</strong> â€” 
                        it varies by tissue type and depth. In the <a href="m-values.html">next chapter</a>, 
                        we'll explore how to calculate these limits.
                    </p>
                </div>
            </div>

            <!-- Section 5: Half-Time Concept (enhanced) -->
            <div class="concept-card" id="half-time-concept">
                <h3>â±ï¸ The Half-Time Concept</h3>
                <p>
                    A tissue's <strong>half-time</strong> is how long it takes to become 50% saturated (or 50% desaturated) 
                    at a given pressure difference. After each half-time period:
                </p>
                <div class="half-time-visual">
                    <div class="half-time-bar">
                        <span class="bar-fill" style="width: 50%;">1 half-time: 50%</span>
                    </div>
                    <div class="half-time-bar">
                        <span class="bar-fill" style="width: 75%;">2 half-times: 75%</span>
                    </div>
                    <div class="half-time-bar">
                        <span class="bar-fill" style="width: 87.5%;">3 half-times: 87.5%</span>
                    </div>
                    <div class="half-time-bar">
                        <span class="bar-fill" style="width: 98.4%;">6 half-times: ~98% (saturated)</span>
                    </div>
                </div>
                <p>A 5-minute compartment reaches 50% saturation in 5 minutes; a 635-minute compartment takes over 10 hours!</p>
                
                <h4 style="margin-top: 1.5rem;">The Pressure Delta Effect</h4>
                <p>
                    The key insight is that half-time determines <em>how quickly</em> you move toward equilibrium, 
                    but the <strong>pressure difference (delta)</strong> determines <em>how much</em> you gain or lose 
                    in absolute terms per half-time.
                </p>
                <p>
                    <strong>Example:</strong> If a tissue needs to off-gas 2 bar of nitrogen, switching from air 
                    (79% Nâ‚‚) to Nitrox 50 (50% Nâ‚‚) or pure Oâ‚‚ (0% Nâ‚‚) creates a much larger pressure gradient, 
                    so each half-time removes more gas â€” this is why oxygen-rich mixes accelerate decompression!
                </p>
            </div>

            <!-- Interactive Half-Time Charts -->
            <div class="concept-card" id="half-time-charts">
                <h3>ğŸ“ˆ Interactive: Pressure Delta & Half-Times</h3>
                <p>These charts demonstrate how the pressure difference affects saturation and desaturation rates.</p>
                
                <div class="half-time-chart-grid">
                    <!-- On-gassing Chart -->
                    <div class="half-time-chart-wrapper">
                        <h4>On-gassing (Descent)</h4>
                        <p class="chart-description">Tissue starts at surface equilibrium (~0.79 bar ppNâ‚‚). 
                           Adjust target depth to see how bigger pressure differences mean faster absolute loading.</p>
                        <div class="chart-controls-inline">
                            <label for="ongassing-depth">Target Depth:</label>
                            <input type="range" id="ongassing-depth" min="10" max="50" value="30" step="5" />
                            <span id="ongassing-depth-value">30m</span>
                            <span id="ongassing-ppn2-value">(ppNâ‚‚ = 3.16 bar)</span>
                        </div>
                        <div class="chart-container-small">
                            <canvas id="ongassing-chart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Off-gassing Chart -->
                    <div class="half-time-chart-wrapper">
                        <h4>Off-gassing (Ascent to Surface)</h4>
                        <p class="chart-description">Tissue starts saturated at the selected depth. 
                           Same half-time, same equationâ€”just inverted. The curves are perfect mirrors.</p>
                        <div class="chart-controls-inline">
                            <span id="offgassing-info">Saturated @ <strong id="offgassing-depth-display">30m</strong> â†’ Surface (~0.79 bar)</span>
                        </div>
                        <div class="chart-container-small">
                            <canvas id="offgassing-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <p class="footnote" style="margin-top: 1rem;">
                    â„¹ï¸ Both charts use the same depth and the same half-time formula. 
                    On-gassing and off-gassing are symmetricalâ€”only the direction changes.
                </p>
            </div>

            <details class="learn-more">
                <summary>ğŸ”¬ Learn More: The Mathematics</summary>
                <div class="math-content">
                    <h4>Haldane Equation (constant depth)</h4>
                    <p>When staying at a constant depth, tissue pressure changes according to:</p>
                    <div class="formula" id="formula-haldane">
                        P_t(t) = P_{alv} + (P_{t0} - P_{alv}) \cdot e^{-kt}
                    </div>
                    <p>Where:</p>
                    <ul>
                        <li><span class="formula-inline">P_t(t)</span> = tissue Nâ‚‚ pressure at time t</li>
                        <li><span class="formula-inline">P_{alv}</span> = inspired (alveolar) Nâ‚‚ pressure</li>
                        <li><span class="formula-inline">P_{t0}</span> = initial tissue Nâ‚‚ pressure</li>
                        <li><span class="formula-inline">k = \frac{\ln(2)}{t_{1/2}}</span> = rate constant</li>
                    </ul>

                    <h4>Schreiner Equation (depth change)</h4>
                    <p>During ascent or descent at a constant rate:</p>
                    <div class="formula" id="formula-schreiner">
                        P_t(t) = P_{alv0} + R \cdot (t - \frac{1}{k}) - (P_{alv0} - P_{t0} - \frac{R}{k}) \cdot e^{-kt}
                    </div>
                    <p>Where <span class="formula-inline">R</span> is the rate of change of alveolar pressure (positive for descent).</p>

                    <h4>Pressure at Depth</h4>
                    <div class="formula" id="formula-pressure">
                        P_{amb} = 1.0 + \frac{depth}{10} \text{ bar}
                    </div>
                    <p>Every 10 meters of seawater adds approximately 1 bar of pressure.</p>
                </div>
            </details>

            <!-- Section 6: Tissue Heterogeneity -->
            <div class="concept-card" id="tissue-heterogeneity">
                <h3>ğŸ§¬ Why Different Tissues Behave Differently</h3>
                <p>
                    Your body is <strong>not homogenous</strong> â€” different tissues have vastly different characteristics 
                    that affect how quickly they absorb and release inert gas:
                </p>
                <ul>
                    <li><strong>Blood perfusion</strong> â€” Well-perfused tissues (brain, heart) exchange gas quickly; 
                        poorly-perfused tissues (cartilage, fat) exchange slowly</li>
                    <li><strong>Gas solubility</strong> â€” Fat dissolves 5Ã— more nitrogen than blood (see table above), 
                        so fatty tissues take longer to saturate</li>
                    <li><strong>Distance from blood supply</strong> â€” Gas must diffuse from capillaries into tissue; 
                        tissues far from blood supply take longer</li>
                </ul>
                <p>
                    This is why decompression models use multiple <strong>theoretical compartments</strong> to simulate 
                    the full range of tissue behaviors in your body.
                </p>
            </div>

            <!-- Section 7: BÃ¼hlmann Compartments -->
            <div class="concept-card" id="buhlmann-compartments">
                <h3>ğŸ”¢ BÃ¼hlmann's ZH-L16 Compartments</h3>
                <p>
                    The BÃ¼hlmann ZH-L16 model uses <strong>16 theoretical compartments</strong> â€” these are 
                    <em>mathematical constructs</em> fit to experimental data, not literal anatomical tissues.
                    They span a range of half-times designed to model the full spectrum of tissue behaviors:
                </p>
                <ul>
                    <li><strong>Fast compartments (5â€“12.5 min)</strong> â€” saturate in minutes, but also release gas quickly</li>
                    <li><strong>Medium compartments (18.5â€“77 min)</strong> â€” balance between loading and off-gassing</li>
                    <li><strong>Slow compartments (109â€“635 min)</strong> â€” can take hours to fully saturate</li>
                </ul>
                <p>
                    At any point during a dive, the <strong>controlling compartment</strong> is the one closest to 
                    its critical supersaturation limit â€” this compartment determines your decompression ceiling.
                </p>
            </div>

            <!-- Section 8: ZH-L16 Variants -->
            <div class="concept-card" id="zhl16-variants">
                <h3>ğŸ”§ ZH-L16 Variants: A, B, and C</h3>
                <p>
                    BÃ¼hlmann developed <strong>three variants</strong> of the ZH-L16 algorithm, each with different 
                    levels of conservatism. The variants differ only in their <strong>'a' coefficients</strong> â€” the 
                    half-times and 'b' values remain the same.
                </p>
                
                <div class="variant-grid">
                    <div class="variant-card">
                        <h4>ZH-L16A <span class="variant-badge">Experimental</span></h4>
                        <p>
                            The <strong>original</strong> values derived from experimental data. 
                            Least conservative â€” allows the most supersaturation.
                        </p>
                        <p class="variant-use">ğŸ“š Used for: Research, algorithm comparison</p>
                    </div>
                    
                    <div class="variant-card">
                        <h4>ZH-L16B <span class="variant-badge">Tables</span></h4>
                        <p>
                            Modified 'a' values for <strong>printed dive tables</strong>. More conservative in 
                            compartments 5â€“8 and 13 to account for the inherent rounding in table use.
                        </p>
                        <p class="variant-use">ğŸ“‹ Used for: Published decompression tables</p>
                    </div>
                    
                    <div class="variant-card variant-card-active">
                        <h4>ZH-L16C <span class="variant-badge variant-badge-active">Computers</span></h4>
                        <p>
                            <strong>Most conservative</strong> â€” modified 'a' values for compartments 5â€“15. 
                            Since dive computers track depth and time precisely (no table rounding), 
                            additional conservatism was added for real-world safety margins.
                        </p>
                        <p class="variant-use">ğŸ’» Used for: Dive computers (most common today)</p>
                    </div>
                </div>
                
                <details class="learn-more">
                    <summary>ğŸ“Š Variant Differences in 'a' Coefficients</summary>
                    <div class="math-content">
                        <p>
                            The 'a' coefficient determines the <strong>y-intercept</strong> of the M-value line. 
                            <em>Lower 'a' values = more conservative</em> (less supersaturation allowed).
                        </p>
                        <table class="data-table small-table">
                            <thead>
                                <tr>
                                    <th>Compartment</th>
                                    <th>ZH-L16A</th>
                                    <th>ZH-L16B</th>
                                    <th>ZH-L16C</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>1â€“4</td><td colspan="3" style="text-align:center;">Same across all variants</td></tr>
                                <tr class="highlight-row"><td>5</td><td>0.6667</td><td>0.5600</td><td><strong>0.5282</strong></td></tr>
                                <tr class="highlight-row"><td>6</td><td>0.5933</td><td>0.4947</td><td><strong>0.4701</strong></td></tr>
                                <tr class="highlight-row"><td>7</td><td>0.5282</td><td>0.4500</td><td><strong>0.4187</strong></td></tr>
                                <tr class="highlight-row"><td>8</td><td>0.4701</td><td>0.4187</td><td><strong>0.3798</strong></td></tr>
                                <tr><td>9â€“15</td><td colspan="2" style="text-align:center;">Various</td><td><strong>More conservative</strong></td></tr>
                                <tr><td>16</td><td colspan="3" style="text-align:center;">0.2327 (same)</td></tr>
                            </tbody>
                        </table>
                        <p class="footnote">This application uses <strong>ZH-L16C</strong> as the default, matching modern dive computers.</p>
                    </div>
                </details>
            </div>
        </section>

        <!-- Compartment Selection -->
        <section id="compartment-selection" class="compartment-section">
            <h2>ğŸ›ï¸ Compartment Selection</h2>
            <p>Toggle which tissue compartments to display on the chart:</p>
            
            <div class="compartment-controls">
                <button id="show-all" class="btn btn-small">Show All</button>
                <button id="hide-all" class="btn btn-small">Hide All</button>
                <button id="show-fast" class="btn btn-small">Fast Only</button>
                <button id="show-medium" class="btn btn-small">Medium Only</button>
                <button id="show-slow" class="btn btn-small">Slow Only</button>
            </div>
            
            <div id="compartment-toggles" class="compartment-toggles">
                <!-- Checkboxes added by JavaScript -->
            </div>
        </section>

        <!-- Chart Section -->
        <section id="tissue-chart-section" class="chart-section">
            <div class="chart-header">
                <h2>ğŸ“ˆ Tissue Loading Chart</h2>
                <button id="fullscreen-btn" class="btn btn-small btn-icon" title="Fullscreen">
                    <span class="fullscreen-icon">â›¶</span>
                    <span class="fullscreen-text">Fullscreen</span>
                </button>
            </div>
            <div class="chart-container" id="chart-container">
                <canvas id="tissue-chart"></canvas>
                <button id="exit-fullscreen-btn" class="btn btn-fullscreen-close" title="Exit Fullscreen">âœ•</button>
            </div>
            <p class="timeline-hint">â†‘â†“ move tissues | Shift+â†‘ expand | Shift+â†“ shrink</p>
            <div class="chart-legend">
                <p><strong>Left axis (Nâ‚‚ Pressure):</strong> Shows nitrogen pressure in each tissue compartment. 
                   Higher values = more nitrogen dissolved.</p>
                <p><strong>Right axis (Depth):</strong> Shows the dive profile (depth increases downward).</p>
                <p><strong>Green dashed line (Alveolar Nâ‚‚):</strong> The Nâ‚‚ pressure in your lungs â€” this is what 
                   tissues are trying to equilibrate towards. When tissue &lt; alveolar, you're on-gassing; 
                   when tissue &gt; alveolar, you're off-gassing. The crossover is where tissue loading peaks.</p>
                <p><strong>Red dashed line (Ambient Pressure):</strong> The total pressure at current depth. 
                   Bubble risk increases when tissue inert-gas tension exceeds ambient pressure beyond an 
                   allowable gradient (defined by M-values / gradient factors). Some supersaturation is normal 
                   and permitted during controlled ascents.</p>
                <p><strong>Gray dashed line (Surface Saturation):</strong> Equilibrium Nâ‚‚ pressure at surface (~0.79 bar).</p>
            </div>
            
            <a id="tissue-sandbox-link" href="sandbox/" class="sandbox-link" target="_blank">
                ğŸ”¬ Open in Sandbox â†’
            </a>
        </section>

        <!-- Compartment Reference Table -->
        <section id="reference-table" class="reference-section">
            <h2>ğŸ“‹ BÃ¼hlmann ZH-L16C Compartments Reference</h2>
            <table class="reference-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Half-Time</th>
                        <th>Category</th>
                        <th>Tissue Type</th>
                        <th>Time to Saturate*</th>
                    </tr>
                </thead>
                <tbody id="reference-body">
                    <!-- Rows added by JavaScript -->
                </tbody>
            </table>
            <p class="footnote">* Approximate time to reach 98% saturation (6 half-times)</p>
        </section>
    </main>

    <footer>
        <span class="wip-badge">Experimental</span>
        <p>
            <strong>Educational Use Only</strong> â€” Not for dive planning.
            <br>
            <a href="about.html">Learn more about this project</a>
        </p>
        <span class="version-number"></span>
    </footer>

    <!-- Educational interactive components -->
    <script src="js/tissueEducation.js"></script>

    <!-- Main application script -->
    <script type="module" src="js/main.js"></script>

    <!-- Shared Navigation -->
    <script src="js/nav.js" type="module"></script>
</body>
</html>
